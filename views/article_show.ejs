<!DOCTYPE html>
<html lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta content="" name="description">
    <meta content="" name="keywords">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="HandheldFriendly" content="true">
    <meta content="telephone=no" name="format-detection">

    <link rel="shortcut icon" type="image/png" href="favicon.png" />

    <link rel="stylesheet" href="/public/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/public/css/bootstrap-theme.min.css"/>
    <link href="/public/css/main.css" rel="stylesheet" type="text/css" />
    <link href="/public/css/jquery.mCustomScrollbar.min.css" rel="stylesheet" type="text/css" />

    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="/public/js/jquery-2.2.0.min.js"></script>
    <script src="/public/js/bootstrap.min.js"></script>
    <script src="/public/js/main.js"></script>
    <script src="/public/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <title>News</title>
</head>
<body>
<!-- Header -->
<% include header.ejs%>
<!-- END header -->
<!-- header slider -->
<div class="wrapper">
    <article class="container articles">
        <div class="row">
            <div class="col-sm-4 col-md-3 right_sidebar hidden-xs hidden-sm mCustomScrollbar" data-mcs-theme="dark" data-mcs-axis="y" data-offset-top="112" data-offset-bottom="80">
                <div class="news-tabs">
                    <p class="news-tabs__title h2">最新文章</p>
                    <ul class="news-tabs__nav nav nav-tabs shadow_text" role="tablist">
                        <li role="presentation" class="active">
                                <a href="" >
                                <span class="time"><%=data[0][0]['time']%></span>
                                    <%=data[0][0]['title']%>
                            </a>
                        </li>
                        <% for(var i in data[1]){%>
                        <li role="presentation">
                            <a href="/article/<%=data[1][i]['id']%>.html">
                                <span class="time"><%=data[1][i]['time']%></span>
                                <%=data[1][i]['title']%>
                            </a>
                        </li>
                        <%}%>
                    </ul>
                </div>
            </div>
            <div class="col-sm-12 col-md-9 p0 wrap-headline">
                <div style="width:100%;height:300px;background:url(/public/<%=data[0][0]['fengmian']%>);background-position:center center;background-size:100% auto" class="wrap-headline__img"></div>
                <div class="headline clearfix">
                    <div class="headline__data">
                        <a href="category.ejs" class="headline__category headline__category_orange"><%=data[0][0]['info']%></a>
                        <p class="headline__category"><%=data[0][0]['time']%></p>
                    </div>
                    <div class="share">
                        <ul class="share__list">
                            <li class="share__row">
                                <a class="share__link share__link_bg-facebook" href="#">
                                    <i class="bg bg_facebook">&ensp;</i>
                                </a>
                                <span class="share__number">13</span>
                            </li>
                            <li class="share__row">
                                <a class="share__link share__link_bg-twitter" href="#">
                                    <i class="bg bg_twitter">&ensp;</i>
                                </a>
                                <span class="share__number">26</span>
                            </li>
                            <li class="share__row">
                                <a class="share__link share__link_bg-google" href="#">
                                    <i class="bg bg_google">&ensp;</i>
                                </a>
                                <span class="share__number">17</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-9">
                <div class="mCustomScrollbar" >
                    <h1 class="text-center yel_line current__title"><%=data[0][0]['title']%></h1>
                    <%-data[0][0]['content']%>
                </div>
                <div class="col-sm-12 col-md-9 tags">
                    <p>Tags</p>
                    <ul>
                        <li>
                            <a href="#" title="World" class="font"><%=data[0][0]['info']%></a>
                        </li>
                    </ul>
                </div>
                <div class="col-sm-9 col-md-9 col-lg-9 comments">
                    <p class="comments__title">评论</p>
                    <div id="articleId" style="display:none"><%=aticleId%></div>
                    <%if(locals.login){%>
                        <div class="comments__form">
                        <div>
                            <div class="form-group">
                                <textarea name="text" id="conment_con" class="form-control" overflow-y="auto" name="comment_con" required="required" ></textarea>
                            </div>
                            <div id="userId" style="display:none"><%=locals.nowid%></div>
                            <div id="username" style="display:none"><%=locals.login%></div>
                            <button type="button" id="submit" class="btn btn-comment">评论</button>
                        </div>
                    </div>
                    <%}else{%>
                        <div class="col-sm-9 col-md-9 col-lg-9">尚未登录，<a href="/loginIn" >去登录</a></div>
                    <%}%>
                    <div id="comment_con">
                        <%for(var i in data[2]){%>
                        <div class="comments__media" >
                            <div class="media-middle">
                                <div class="comm_info">
                                    <h4 class="media-heading"><%=data[2][i]['username']%></h4>
                                    <span class="time"><%=data[2][i]['dataTime']%></span>
                                </div>
                            </div>
                            <p class="media-body"><%=data[2][i]['comment_con']%></p>
                        </div>
                        <%}%>
                    </div>
                    <div class="ajax_load">
                        <i class="icon-arrows-cw"></i>Load more
                        <svg id="more" width="128" height="40" viewBox="0 0 128 40" xmlns="http://www.w3.org/2000/svg">
                            <rect x='0' y='0' fill='none' width='128' height='40'></rect>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </article>
</div>
<!-- Footer -->
<% include footer.ejs %>
<!-- END Footer -->
</body>
<script>
    var showNumber=0;
    var length=0;
    $('#submit').click(function(){
        var articleId=$('#articleId').html();
        var userId=$('#userId').html();
        var username=$('#username').html();
        var conment_con=$('#conment_con').val();
       $.ajax({
           url:'/comment',
           type:'post',
           dataType:'json',
           data:{
               articleId:articleId,
               userId:userId,
               username:username,
               conment_con:conment_con
           },success:(data)=>{
               alert(data.success);
               window.location.reload()
           },error:(data)=>{
                alert(评论失败);
           }
       });
    })

    $('#more').click(function(){
        showNumber=showNumber+5;
        var  articleId=$('#articleId').html();
        $.ajax({
            url:'/comment_page',
            type:'post',
            dataType:'json',
            data:{
                articleId:articleId,
                showNumber:showNumber
            },success:(data)=>{
                var moreData=data.data_more;

                if(length!=moreData.length){
                    for(var i in moreData){
                        if(i>=length){
                            $('#comment_con').append('<div class="comments__media"><div class="media-middle"><div class="comm_info"><h4 class="media-heading">'+moreData[i]['username']+'</h4><span class="time">'+moreData[i]['dataTime']+'</span></div></div><p class="media-body">'+moreData[i]['comment_con']+'</p></div>');
                        }

                    }
                    length=moreData.length;
                }else{
                    $('#comment_con').append('<div id="not_con">没有更多评论</div>')
                    setTimeout(function(){
                        $("#not_con").remove();
                    },100)
                }
            },error:(data)=>{

            }
        });
    })
</script>
</html>



